<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <property name="autoIncrement" value="true"/>

    <changeSet  failOnError="true" id="20231111-001" author="kennedy">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_config"/>
            </not>
        </preConditions>

        <sql>
            CREATE TABLE IF NOT EXISTS public.sync_config
            (
                id uuid NOT NULL,
                name character varying(255),
                version character varying(255),
                release_date timestamp without time zone,
                upload_date timestamp without time zone,
                active boolean,
                CONSTRAINT sync_config_pkey PRIMARY KEY (id)
                );
        </sql>
    </changeSet>

    <changeSet  failOnError="true" id="20231111-002" author="kennedy">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_config_module"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE IF NOT EXISTS public.sync_config_module
            (
                id uuid NOT NULL,
                module_name character varying(255),
                min_version character varying(255),
                max_version character varying(255),
                config_id uuid not null,
                CONSTRAINT config_module_pkey PRIMARY KEY (id)
                );

            ALTER TABLE sync_config_module ADD CONSTRAINT fk_config_module_ON_config_id
                FOREIGN KEY (config_id) REFERENCES sync_config (id);
        </sql>
    </changeSet>

    <changeSet  failOnError="true" id="20231111-003" author="kennedy">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_config_table"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE IF NOT EXISTS public.sync_config_table
            (
                id uuid NOT NULL,
                table_name character varying(255),
                exclude_columns character varying(4000),
                update_column character varying(255),
                config_module_id uuid not null,
                has_facility_id boolean,
                CONSTRAINT sync_config_table_pkey PRIMARY KEY (id)
                );

            ALTER TABLE sync_config_table ADD CONSTRAINT fk_config_table_ON_config_module_id
                FOREIGN KEY (config_module_id) REFERENCES sync_config_module (id);
        </sql>
    </changeSet>

    <changeSet  failOnError="true" id="20231111-004" author="kennedy">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_facility_app_key"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE IF NOT EXISTS public.sync_facility_app_key
            (
                id uuid NOT NULL,
                facility_id integer,
                app_key character varying(2000),
                CONSTRAINT sync_facility_app_key_pkey PRIMARY KEY (id)
                );
        </sql>
    </changeSet>
</databaseChangeLog>
