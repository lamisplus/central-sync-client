<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet failOnError="true" author="Emeka" id="central-sync-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_remote_access_token"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE IF NOT EXISTS sync_remote_access_token
				(
				id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
				password character varying(255),
				token character varying(10485760),
				url character varying(255),
				username character varying(255),
				application_user_id bigint,
				organisation_unit_id bigint,
				remote_id bigint,
				pr_key character varying(10485760),
				pub_key character varying(10485760),
				any_pub_key character varying(10485760),
				status bigint,
				CONSTRAINT sync_remote_access_token_pkey PRIMARY KEY (id)
				)
        </sql>
    </changeSet>
    <changeSet failOnError="true" author="Emeka" id="central-sync-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_queue"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE IF NOT EXISTS sync_queue
			(
				id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
				date_created timestamp without time zone NOT NULL,
				file_name character varying(255),
				organisation_unit_id bigint,
				processed integer,
				table_name character varying(255),
				upload_size integer,
				processed_size integer,
				received_size integer,
				created_by character varying,
				CONSTRAINT sync_queue_pkey PRIMARY KEY (id)
			)
        </sql>
    </changeSet>
    <changeSet failOnError="true" author="Emeka" id="central-sync-3">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_history"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE IF NOT EXISTS sync_history
				(
					id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
					date_last_sync timestamp without time zone,
					organisation_unit_id bigint,
					table_name character varying(255),
					processed integer,
					sync_queue_id bigint,
					remote_access_token_id bigint,
					upload_size integer,
					processed_size integer,
					CONSTRAINT sync_history_pkey PRIMARY KEY (id),
					CONSTRAINT remote_access_token_id_fk FOREIGN KEY (remote_access_token_id)
						REFERENCES sync_remote_access_token (id) MATCH SIMPLE
						ON UPDATE NO ACTION
						ON DELETE NO ACTION
				)
        </sql>
    </changeSet>
    <changeSet failOnError="true" author="Emeka" id="central-sync-4">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="sync_remote_key"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE IF NOT EXISTS sync_remote_key
				(
					id bigint NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
					key character varying,
					uuid character varying,
					CONSTRAINT sync_remote_key_pkey PRIMARY KEY (id)
				)
        </sql>
    </changeSet>
</databaseChangeLog>